<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberPulse Security Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary-bg: #0a0e14;
            --card-bg: #151a21;
            --accent-color: #2a9fd6;
            --warning-color: #ff8800;
            --danger-color: #cc0000;
            --success-color: #77b300;
            --text-color: #e6e6e6;
            --border-color: #2d3746;
        }

        body {
            background-color: var(--primary-bg);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .dashboard-container {
            display: none;
            padding: 20px;
        }

        .landing-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: linear-gradient(135deg, #0a0e14 0%, #1a2639 100%);
        }

        .cyber-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .cyber-header {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
            margin-bottom: 15px;
        }

        .stat-card {
            text-align: center;
            padding: 15px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .severity-critical {
            color: var(--danger-color);
        }

        .severity-warning {
            color: var(--warning-color);
        }

        .severity-normal {
            color: var(--success-color);
        }

        .btn-cyber {
            background-color: var(--accent-color);
            border: none;
            color: white;
            padding: 12px 30px;
            font-size: 1.1rem;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .btn-cyber:hover {
            background-color: #2387b8;
            transform: translateY(-2px);
        }

        .btn-outline-cyber {
            background-color: transparent;
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            padding: 12px 30px;
            font-size: 1.1rem;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .btn-outline-cyber:hover {
            background-color: rgba(42, 159, 214, 0.1);
        }

        .btn-block {
            background-color: var(--danger-color);
            border: none;
            color: white;
            padding: 6px 12px;
            font-size: 0.85rem;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .btn-block:hover {
            background-color: #a00;
            transform: translateY(-1px);
        }

        .btn-block:disabled {
            background-color: #555;
            cursor: not-allowed;
            transform: none;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }

        .login-table {
            width: 100%;
            border-collapse: collapse;
        }

        .login-table th, .login-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .login-table th {
            color: var(--accent-color);
            font-weight: 600;
        }

        .date-filter {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 8px 12px;
            border-radius: 4px;
            width: 100%;
        }

        .filter-row {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 150px;
        }

        .filter-label {
            font-size: 0.85rem;
            margin-bottom: 5px;
            color: #8a8a8a;
        }

        .map-container {
            height: 300px;
            background-color: #1e2a3a;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .map-placeholder {
            text-align: center;
            color: #8a8a8a;
        }

        .map-placeholder i {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .navbar-cyber {
            background-color: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            font-weight: bold;
            color: var(--accent-color);
            font-size: 1.5rem;
        }

        .nav-tabs-cyber {
            border-bottom: 1px solid var(--border-color);
        }

        .nav-tabs-cyber .nav-link {
            color: var(--text-color);
            border: none;
            padding: 12px 20px;
        }

        .nav-tabs-cyber .nav-link.active {
            background-color: var(--card-bg);
            color: var(--accent-color);
            border-bottom: 2px solid var(--accent-color);
        }

        .nav-tabs-cyber .nav-link:hover {
            border: none;
            color: var(--accent-color);
        }

        .tab-content {
            padding-top: 20px;
        }

        .report-section {
            margin-bottom: 30px;
        }

        .report-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .report-preview {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            min-height: 400px;
            overflow-x: auto;
        }

        .report-content {
            font-family: 'Times New Roman', Times, serif;
            color: var(--text-color);
            max-width: 100%;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .report-content h4 {
            color: var(--accent-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .report-content p, .report-content li {
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .report-content ul {
            padding-left: 20px;
        }

        .report-placeholder {
            text-align: center;
            padding: 60px 20px;
            color: #8a8a8a;
        }

        .report-placeholder i {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .events-table-container {
            max-height: 500px;
            overflow-y: auto;
        }

        .badge-critical {
            background-color: var(--danger-color);
        }

        .badge-warning {
            background-color: var(--warning-color);
        }

        .badge-normal {
            background-color: var(--success-color);
        }

        .badge-unblocked {
            background-color: #6c757d;
        }

        .blocked-ip {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1055;
        }

        .cyber-toast {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-left: 4px solid var(--accent-color);
        }

        .toast-success {
            border-left-color: var(--success-color);
        }

        .toast-error {
            border-left-color: var(--danger-color);
        }

        .unblocked-ip-row {
            background-color: rgba(108, 117, 125, 0.1);
        }

        .refresh-indicator {
            font-size: 0.8rem;
            color: #8a8a8a;
        }

        .refresh-indicator i {
            color: var(--accent-color);
        }

        .api-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .api-status-online {
            background-color: var(--success-color);
        }

        .api-status-offline {
            background-color: var(--danger-color);
        }

        /* Report-specific styles */
        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .report-table th, .report-table td {
            border: 1px solid var(--border-color);
            padding: 8px 10px;
            text-align: left;
        }

        .report-table th {
            background-color: rgba(42, 159, 214, 0.2);
            color: var(--accent-color);
        }

        .report-metric {
            margin-bottom: 15px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .report-section-title {
            color: var(--accent-color);
            margin-top: 20px;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border-color);
        }
    </style>
</head>
<body>
    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Landing Page -->
    <div class="landing-page" id="landingPage">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <h1 class="display-4 mb-4">CyberPulse Security Dashboard</h1>
                    <p class="lead mb-5">Advanced threat detection and response platform for real-time attack monitoring</p>
                    <div class="mb-4">
                        <span class="api-status api-status-online" id="apiStatus"></span>
                        <span class="text-muted">API Status: <span id="apiStatusText">Checking...</span></span>
                    </div>
                    <button class="btn btn-cyber btn-lg" onclick="startScan()" id="startButton">
                        <i class="fas fa-shield-alt me-2"></i> Scan for Vulnerabilities
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard-container" id="dashboard">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-cyber">
            <div class="container-fluid">
                <a class="navbar-brand logo" href="#">
                    <i class="fas fa-pulse me-2"></i>CyberPulse SOC Dashboard
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="switchTab('dashboard-tab')">Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="switchTab('reports-tab')">Reports</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="switchTab('blocked-ips-tab')">Blocked IPs</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="switchTab('unblocked-ips-tab')">Unblocked IPs</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container-fluid mt-4">
            <!-- Tab Navigation -->
            <ul class="nav nav-tabs nav-tabs-cyber" id="dashboardTabs">
                <li class="nav-item">
                    <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" href="#dashboard-content">Security Dashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="reports-tab" data-bs-toggle="tab" href="#reports-content">Generate Reports</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="blocked-ips-tab" data-bs-toggle="tab" href="#blocked-ips-content">Blocked IPs</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="unblocked-ips-tab" data-bs-toggle="tab" href="#unblocked-ips-content">Unblocked IPs</a>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="dashboardTabContent">
                <!-- Dashboard Tab -->
                <div class="tab-pane fade show active" id="dashboard-content">
                    <!-- Security Summary (AASF3) -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="cyber-card">
                                <h3 class="cyber-header">Security Summary
                                    <span class="refresh-indicator ms-3">
                                        <i class="fas fa-sync-alt me-1"></i>
                                        Auto-refreshes every 30s | Last refresh:
                                        <span id="lastRefresh">Never</span>
                                    </span>
                                </h3>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="stat-card">
                                            <div>Total Attacks</div>
                                            <div class="stat-value" id="totalAttacks">0</div>
                                            <div class="text-muted">Last 24 hours</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-card">
                                            <div>Failed Logins</div>
                                            <div class="stat-value severity-critical" id="failedLogins">0</div>
                                            <div class="text-muted">High risk</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-card">
                                            <div>Brute Force Attempts</div>
                                            <div class="stat-value severity-warning" id="bruteForceAttempts">0</div>
                                            <div class="text-muted">Medium risk</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-card">
                                            <div>Blocked IPs</div>
                                            <div class="stat-value severity-warning" id="blockedIpsCount">0</div>
                                            <div class="text-muted">Active blocks</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-12 text-end">
                                        <button class="btn btn-outline-cyber btn-sm" onclick="manualRefresh()">
                                            <i class="fas fa-sync me-1"></i>Refresh Now
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Date Range Filter (AASN1) - Updated Layout -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="cyber-card">
                                <h5 class="cyber-header">Filter Security Events</h5>
                                <div class="filter-row">
                                    <div class="filter-group">
                                        <span class="filter-label">Start Date</span>
                                        <input type="datetime-local" class="date-filter" id="startDate">
                                    </div>
                                    <div class="filter-group">
                                        <span class="filter-label">End Date</span>
                                        <input type="datetime-local" class="date-filter" id="endDate">
                                    </div>
                                    <div class="filter-group">
                                        <span class="filter-label">Severity</span>
                                        <select class="date-filter" id="severityFilter">
                                            <option value="all">All Severities</option>
                                            <option value="critical">Critical</option>
                                            <option value="warning">Warning</option>
                                            <option value="normal">Normal</option>
                                        </select>
                                    </div>
                                    <div class="filter-group">
                                        <span class="filter-label">Event Type</span>
                                        <select class="date-filter" id="eventTypeFilter">
                                            <option value="all">All Events</option>
                                            <option value="failed-login">Failed Login</option>
                                            <option value="brute-force">Brute Force</option>
                                            <option value="ssh-anomaly">SSH Anomaly</option>
                                            <option value="powershell-abuse">PowerShell Abuse</option>
                                            <option value="port-scan">Port Scan</option>
                                        </select>
                                    </div>
                                    <div class="filter-group" style="align-self: flex-end;">
                                        <button class="btn btn-cyber" onclick="applyFilters()">Apply Filters</button>
                                        <button class="btn btn-outline-cyber mt-2" onclick="resetFilters()">Reset</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Left Column -->
                        <div class="col-md-8">
                            <!-- Login Charts (AASF1, AASF2) -->
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="cyber-card">
                                        <h5 class="cyber-header">Failed Logins Per Hour</h5>
                                        <div class="chart-container">
                                            <canvas id="failedLoginsChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="cyber-card">
                                        <h5 class="cyber-header">Successful Logins Per Hour</h5>
                                        <div class="chart-container">
                                            <canvas id="successfulLoginsChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Detected Security Events Table -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="cyber-card">
                                        <h5 class="cyber-header">Detected Security Events</h5>
                                        <div class="events-table-container">
                                            <table class="login-table">
                                                <thead>
                                                    <tr>
                                                        <th>Time</th>
                                                        <th>IP Address</th>
                                                        <th>Username</th>
                                                        <th>Event Type</th>
                                                        <th>Severity</th>
                                                        <th>Source</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="securityEventsTable">
                                                    <tr>
                                                        <td colspan="7" class="text-center py-4">No security events detected yet</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column -->
                        <div class="col-md-4">
                            <!-- Severity Levels (AASF5) -->
                            <div class="cyber-card mb-4">
                                <h5 class="cyber-header">Severity Level</h5>
                                <div class="chart-container">
                                    <canvas id="severityChart"></canvas>
                                </div>
                            </div>

                            <!-- Geographic Threat Mapping (AASF4) -->
                            <div class="cyber-card">
                                <h5 class="cyber-header">Geographic Threat Mapping</h5>
                                <div class="map-container">
                                    <div class="map-placeholder">
                                        <i class="fas fa-globe-americas"></i>
                                        <p>Threat visualization map would appear here</p>
                                        <p class="small">IP locations and frequency visualization</p>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <h6>Top IP Addresses</h6>
                                    <div class="chart-container">
                                        <canvas id="ipFrequencyChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Tab -->
                <div class="tab-pane fade" id="reports-content">
                    <div class="row">
                        <div class="col-12">
                            <div class="cyber-card">
                                <h3 class="cyber-header">Generate Security Reports</h3>

                                <!-- Report Configuration -->
                                <div class="report-section">
                                    <h5>Report Configuration</h5>
                                    <div class="report-controls">
                                        <div>
                                            <label class="form-label">Report Type</label>
                                            <select class="form-select date-filter" id="reportType">
                                                <option value="Summary">Security Summary</option>
                                                <option value="Detailed">Detailed Analysis</option>
                                                <option value="Compliance">Compliance Report</option>
                                                <option value="Threat">Threat Intelligence</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label class="form-label">Time Period</label>
                                            <select class="form-select date-filter" id="reportPeriod">
                                                <option value="24hr">Last 24 Hours</option>
                                                <option value="7d">Last 7 Days</option>
                                                <option value="30d">Last 30 Days</option>
                                                <option value="custom">Custom Range</option>
                                            </select>
                                        </div>

                                        <div id="customDateRange" style="display: none;">
                                            <label class="form-label">Custom Range</label>
                                            <div class="d-flex align-items-center">
                                                <input type="date" class="date-filter me-2" id="customStartDate">
                                                <span class="me-2">to</span>
                                                <input type="date" class="date-filter" id="customEndDate">
                                            </div>
                                        </div>

                                        <div>
                                            <label class="form-label">Format</label>
                                            <select class="form-select date-filter" id="reportFormat">
                                                <option value="pdf">PDF</option>
                                                <option value="html">HTML</option>
                                                <option value="csv">CSV</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="mt-3">
                                        <button class="btn btn-cyber me-2" onclick="generateReport()">
                                            <i class="fas fa-file-pdf me-2"></i>Generate Report
                                        </button>
                                        <button class="btn btn-outline-cyber" onclick="previewReport()">
                                            <i class="fas fa-eye me-2"></i>Preview
                                        </button>
                                    </div>
                                </div>

                                <!-- Report Preview -->
                                <div class="report-section">
                                    <h5>Report Preview</h5>
                                    <div class="report-preview">
                                        <div class="report-placeholder" id="reportPlaceholder">
                                            <i class="fas fa-file-alt"></i>
                                            <p>No report generated yet</p>
                                            <p class="small">Configure your report settings and click "Generate Report"</p>
                                        </div>
                                        <div id="reportContent" class="report-content" style="display: none;">
                                            <!-- Report content will be generated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Blocked IPs Tab -->
                <div class="tab-pane fade" id="blocked-ips-content">
                    <div class="row">
                        <div class="col-12">
                            <div class="cyber-card">
                                <h3 class="cyber-header">Blocked IP Addresses</h3>
                                <div class="mb-3">
                                    <button class="btn btn-outline-cyber" onclick="clearAllBlocks()">
                                        <i class="fas fa-trash me-2"></i>Clear All Blocks
                                    </button>
                                </div>
                                <div class="events-table-container">
                                    <table class="login-table">
                                        <thead>
                                            <tr>
                                                <th>IP Address</th>
                                                <th>Blocked At</th>
                                                <th>Reason</th>
                                                <th>Events Count</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="blockedIpsTable">
                                            <tr>
                                                <td colspan="5" class="text-center py-4">No IP addresses blocked yet</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Unblocked IPs Tab -->
                <div class="tab-pane fade" id="unblocked-ips-content">
                    <div class="row">
                        <div class="col-12">
                            <div class="cyber-card">
                                <h3 class="cyber-header">Unblocked IP Addresses</h3>
                                <div class="mb-3">
                                    <button class="btn btn-outline-cyber" onclick="clearUnblockedHistory()">
                                        <i class="fas fa-trash me-2"></i>Clear Unblocked History
                                    </button>
                                </div>
                                <div class="events-table-container">
                                    <table class="login-table">
                                        <thead>
                                            <tr>
                                                <th>IP Address</th>
                                                <th>Originally Blocked</th>
                                                <th>Unblocked At</th>
                                                <th>Reason</th>
                                                <th>Events Count</th>
                                                <th>Block Duration</th>
                                            </tr>
                                        </thead>
                                        <tbody id="unblockedIpsTable">
                                            <tr>
                                                <td colspan="6" class="text-center py-4">No IP addresses have been unblocked yet</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ============================================
        // GLOBAL VARIABLES AND CONFIGURATION
        // ============================================
        const API_BASE_URL = 'https://api.allorigins.win/raw?url=http://3.145.146.136:5000';
        let blockedIPs = [];
        let unblockedIPs = [];
        let securityEvents = [];
        let loginStats = {
            failedByHour: [5, 3, 8, 12, 6, 9, 15, 10, 7, 4, 6, 8],
            successfulByHour: [2, 1, 3, 5, 8, 10, 7, 6, 4, 3, 2, 1],
            hours: ['00:00', '02:00', '04:00', '06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00']
        };
        let refreshInterval;
        let isAPIOnline = false;
        let charts = {};

        // ============================================
        // INITIALIZATION FUNCTIONS
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Set default datetime values for filters
            const now = new Date();
            const oneHourAgo = new Date(now.getTime() - (60 * 60 * 1000));
            const formatDateTime = (date) => date.toISOString().slice(0, 16);

            document.getElementById('startDate').value = formatDateTime(oneHourAgo);
            document.getElementById('endDate').value = formatDateTime(now);

            // Set default dates for custom range
            const today = new Date();
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(today.getDate() - 7);
            document.getElementById('customStartDate').valueAsDate = oneWeekAgo;
            document.getElementById('customEndDate').valueAsDate = today;

            // Show/hide custom date range
            document.getElementById('reportPeriod').addEventListener('change', function() {
                document.getElementById('customDateRange').style.display =
                    this.value === 'custom' ? 'block' : 'none';
            });

            // Check API status on page load
            checkAPIStatus();
        });

        // ============================================
        // API CONNECTION FUNCTIONS
        // ============================================
        async function checkAPIStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/security-alerts`, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });

                if (response.ok) {
                    isAPIOnline = true;
                    document.getElementById('apiStatus').className = 'api-status api-status-online';
                    document.getElementById('apiStatusText').textContent = 'Online';
                    document.getElementById('startButton').disabled = false;
                } else {
                    throw new Error('API not responding properly');
                }
            } catch (error) {
                isAPIOnline = false;
                document.getElementById('apiStatus').className = 'api-status api-status-offline';
                document.getElementById('apiStatusText').textContent = 'Offline - Using demo data';
                document.getElementById('startButton').disabled = false;
                showToast('API is offline. Using demo data.', 'warning');
            }
        }

        async function fetchAllData() {
            try {
                showToast('Refreshing security data...', 'info');

                if (!isAPIOnline) {
                    // Use demo data when API is offline
                    securityEvents = getDemoData();
                } else {
                    // Fetch from API
                    const alertsResponse = await fetch(`${API_BASE_URL}/api/security-alerts`);
                    const alertsData = await alertsResponse.json();

                    // Convert API data to our format
                    securityEvents = convertAPIData(alertsData.alerts || []);

                    // Update stats from API
                    updateStatsFromAPI(alertsData);
                }

                // Update UI
                updateSecurityEventsTable();
                updateSummaryStatistics();
                updateChartsWithRealData();

                // Update refresh time
                const now = new Date();
                document.getElementById('lastRefresh').textContent = now.toLocaleTimeString();

                showToast(`Data refreshed: ${securityEvents.length} events loaded`, 'success');

            } catch (error) {
                console.error('Error fetching data:', error);
                securityEvents = getDemoData();
                updateSecurityEventsTable();
                updateSummaryStatistics();
                showToast('Error loading data. Using demo data.', 'error');
            }
        }

        function convertAPIData(apiAlerts) {
            if (!apiAlerts || !Array.isArray(apiAlerts)) return getDemoData();

            return apiAlerts.map((alert, index) => {
                // Determine severity based on available data
                let severity = 'Warning'; // Default
                if (alert.severity) {
                    severity = alert.severity.charAt(0).toUpperCase() + alert.severity.slice(1);
                }

                // Determine event type
                let eventType = alert.event_type || 'Security Alert';
                if (eventType === 'test') eventType = 'Test Event';

                // Format timestamp
                let time = alert.timestamp || new Date().toISOString();
                try {
                    const date = new Date(time);
                    time = date.toLocaleString();
                } catch (e) {
                    time = new Date().toLocaleString();
                }

                return {
                    id: index + 1,
                    time: time,
                    ip: alert.source_ip || alert.ip_address || `192.168.1.${100 + index}`,
                    username: alert.username || ['admin', 'root', 'user123', 'jsmith'][index % 4],
                    eventType: eventType,
                    severity: severity,
                    source: alert.source || (alert.source_ip ? 'External' : 'Internal')
                };
            });
        }

        function updateStatsFromAPI(apiData) {
            // Update summary statistics from API response
            document.getElementById('totalAttacks').textContent = apiData.total_alerts || securityEvents.length;
            document.getElementById('failedLogins').textContent = securityEvents.filter(e =>
                e.eventType.includes('Failed') || e.eventType.includes('Login')
            ).length;
            document.getElementById('bruteForceAttempts').textContent = securityEvents.filter(e =>
                e.eventType.includes('Brute') || e.eventType.includes('Force')
            ).length;
        }

        function getDemoData() {
            return [
                { id: 1, time: '12/04/2025 12:45 AM', ip: '192.168.1.105', username: 'admin', eventType: 'Failed Login', severity: 'Critical', source: 'Internal' },
                { id: 2, time: '12/04/2025 12:47 AM', ip: '203.0.113.25', username: 'root', eventType: 'Brute Force', severity: 'Critical', source: 'External' },
                { id: 3, time: '12/04/2025 12:52 AM', ip: '192.168.1.110', username: 'user123', eventType: 'Failed Login', severity: 'Warning', source: 'Internal' },
                { id: 4, time: '12/04/2025 12:55 AM', ip: '198.51.100.34', username: 'jsmith', eventType: 'SSH Anomaly', severity: 'Warning', source: 'External' },
                { id: 5, time: '12/04/2025 12:58 AM', ip: '192.168.1.105', username: 'admin', eventType: 'PowerShell Abuse', severity: 'Critical', source: 'Internal' },
                { id: 6, time: '12/04/2025 01:05 AM', ip: '203.0.113.42', username: 'test', eventType: 'Port Scan', severity: 'Warning', source: 'External' },
                { id: 7, time: '12/04/2025 01:12 AM', ip: '192.168.1.120', username: 'mjones', eventType: 'Successful Login', severity: 'Normal', source: 'Internal' },
            ];
        }

        // ============================================
        // DASHBOARD CONTROL FUNCTIONS
        // ============================================
        function startScan() {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';

            // Initialize charts
            initializeCharts();

            // Start fetching data
            fetchAllData();

            // Set up automatic refresh every 30 seconds
            if (refreshInterval) clearInterval(refreshInterval);
            refreshInterval = setInterval(fetchAllData, 30000);

            showToast('Dashboard initialized. Auto-refresh enabled.', 'success');
        }

        function manualRefresh() {
            fetchAllData();
        }

        function switchTab(tabId) {
            const tabElement = document.getElementById(tabId);
            if (tabElement) {
                const tab = new bootstrap.Tab(tabElement);
                tab.show();
            }
        }

        // ============================================
        // UI UPDATE FUNCTIONS
        // ============================================
        function updateSecurityEventsTable() {
            const eventsTable = document.getElementById('securityEventsTable');
            eventsTable.innerHTML = '';

            if (securityEvents.length === 0) {
                eventsTable.innerHTML = '<tr><td colspan="7" class="text-center py-4">No security events detected yet</td></tr>';
                return;
            }

            securityEvents.forEach(event => {
                const row = document.createElement('tr');
                const isBlocked = blockedIPs.some(blocked => blocked.ip === event.ip);

                if (isBlocked) {
                    row.classList.add('blocked-ip');
                }

                let badgeClass = 'badge-normal';
                if (event.severity === 'Critical') badgeClass = 'badge-critical';
                else if (event.severity === 'Warning') badgeClass = 'badge-warning';

                row.innerHTML = `
                    <td>${event.time}</td>
                    <td>${event.ip}</td>
                    <td>${event.username}</td>
                    <td>${event.eventType}</td>
                    <td><span class="badge ${badgeClass}">${event.severity}</span></td>
                    <td>${event.source}</td>
                    <td>
                        <button class="btn btn-block" onclick="blockIP('${event.ip}', '${event.eventType}')" ${isBlocked ? 'disabled' : ''}>
                            <i class="fas fa-ban me-1"></i>Block IP
                        </button>
                    </td>
                `;

                eventsTable.appendChild(row);
            });
        }

        function updateBlockedIPsTable() {
            const blockedTable = document.getElementById('blockedIpsTable');
            blockedTable.innerHTML = '';

            if (blockedIPs.length === 0) {
                blockedTable.innerHTML = '<tr><td colspan="5" class="text-center py-4">No IP addresses blocked yet</td></tr>';
                return;
            }

            blockedIPs.forEach(blocked => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${blocked.ip}</td>
                    <td>${blocked.blockedAt}</td>
                    <td>${blocked.reason}</td>
                    <td>${blocked.eventCount}</td>
                    <td>
                        <button class="btn btn-outline-cyber btn-sm" onclick="unblockIP('${blocked.ip}')">
                            <i class="fas fa-unlock me-1"></i>Unblock
                        </button>
                    </td>
                `;
                blockedTable.appendChild(row);
            });

            document.getElementById('blockedIpsCount').textContent = blockedIPs.length;
        }

        function updateUnblockedIPsTable() {
            const unblockedTable = document.getElementById('unblockedIpsTable');
            unblockedTable.innerHTML = '';

            if (unblockedIPs.length === 0) {
                unblockedTable.innerHTML = '<tr><td colspan="6" class="text-center py-4">No IP addresses have been unblocked yet</td></tr>';
                return;
            }

            unblockedIPs.forEach(unblocked => {
                const row = document.createElement('tr');
                row.classList.add('unblocked-ip-row');

                const duration = calculateBlockDuration(unblocked.blockedAt, unblocked.unblockedAt);

                row.innerHTML = `
                    <td>${unblocked.ip}</td>
                    <td>${unblocked.blockedAt}</td>
                    <td>${unblocked.unblockedAt}</td>
                    <td>${unblocked.reason}</td>
                    <td>${unblocked.eventCount}</td>
                    <td>${duration}</td>
                `;
                unblockedTable.appendChild(row);
            });
        }

        function updateSummaryStatistics() {
            document.getElementById('totalAttacks').textContent = securityEvents.length;
            document.getElementById('failedLogins').textContent = securityEvents.filter(e =>
                e.eventType.includes('Failed') || e.eventType.includes('Login')
            ).length;
            document.getElementById('bruteForceAttempts').textContent = securityEvents.filter(e =>
                e.eventType.includes('Brute') || e.eventType.includes('Force')
            ).length;
            document.getElementById('blockedIpsCount').textContent = blockedIPs.length;
        }

        function updateChartsWithRealData() {
            if (!charts.failedLogins || !charts.successfulLogins || !charts.severity || !charts.ipFrequency) return;

            // Update failed logins chart
            charts.failedLogins.data.labels = loginStats.hours;
            charts.failedLogins.data.datasets[0].data = loginStats.failedByHour;
            charts.failedLogins.update();

            // Update successful logins chart
            charts.successfulLogins.data.labels = loginStats.hours;
            charts.successfulLogins.data.datasets[0].data = loginStats.successfulByHour;
            charts.successfulLogins.update();

            // Update severity chart
            const severityDist = getSeverityDistribution();
            charts.severity.data.datasets[0].data = [severityDist.critical, severityDist.warning, severityDist.normal];
            charts.severity.update();

            // Update IP frequency chart
            const ipFrequency = getIPFrequency().slice(0, 8); // Top 8 IPs
            charts.ipFrequency.data.labels = ipFrequency.map(ip => ip.ip);
            charts.ipFrequency.data.datasets[0].data = ipFrequency.map(ip => ip.count);
            charts.ipFrequency.update();
        }

        // ============================================
        // IP BLOCKING/UNBLOCKING FUNCTIONS
        // ============================================
        function blockIP(ip, reason) {
            if (blockedIPs.some(blocked => blocked.ip === ip)) {
                showToast('IP address is already blocked', 'error');
                return;
            }

            const eventCount = securityEvents.filter(event => event.ip === ip).length;
            const blockedAt = new Date().toLocaleString();

            blockedIPs.push({
                ip: ip,
                blockedAt: blockedAt,
                reason: reason,
                eventCount: eventCount
            });

            updateSecurityEventsTable();
            updateBlockedIPsTable();
            updateSummaryStatistics();

            showToast(`IP address ${ip} has been blocked`, 'success');
        }

        function unblockIP(ip) {
            const blockedIP = blockedIPs.find(blocked => blocked.ip === ip);
            if (!blockedIP) {
                showToast('IP address not found in blocked list', 'error');
                return;
            }

            const unblockedAt = new Date().toLocaleString();
            unblockedIPs.push({
                ...blockedIP,
                unblockedAt: unblockedAt
            });

            blockedIPs = blockedIPs.filter(blocked => blocked.ip !== ip);

            updateSecurityEventsTable();
            updateBlockedIPsTable();
            updateUnblockedIPsTable();
            updateSummaryStatistics();

            showToast(`IP address ${ip} has been unblocked`, 'success');
        }

        function clearAllBlocks() {
            if (blockedIPs.length === 0) {
                showToast('No IP addresses to unblock', 'info');
                return;
            }

            if (confirm('Are you sure you want to unblock all IP addresses?')) {
                const unblockedAt = new Date().toLocaleString();
                blockedIPs.forEach(blocked => {
                    unblockedIPs.push({
                        ...blocked,
                        unblockedAt: unblockedAt
                    });
                });

                blockedIPs = [];
                updateSecurityEventsTable();
                updateBlockedIPsTable();
                updateUnblockedIPsTable();
                updateSummaryStatistics();
                showToast('All IP addresses have been unblocked', 'success');
            }
        }

        function clearUnblockedHistory() {
            if (unblockedIPs.length === 0) {
                showToast('No unblocked IP history to clear', 'info');
                return;
            }

            if (confirm('Are you sure you want to clear all unblocked IP history?')) {
                unblockedIPs = [];
                updateUnblockedIPsTable();
                showToast('Unblocked IP history cleared', 'success');
            }
        }

        // ============================================
        // CHART FUNCTIONS
        // ============================================
        function initializeCharts() {
            // Failed Logins Per Hour Chart
            const failedCtx = document.getElementById('failedLoginsChart').getContext('2d');
            charts.failedLogins = new Chart(failedCtx, {
                type: 'line',
                data: {
                    labels: loginStats.hours,
                    datasets: [{
                        label: 'Failed Logins',
                        data: loginStats.failedByHour,
                        borderColor: '#cc0000',
                        backgroundColor: 'rgba(204, 0, 0, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#e6e6e6' }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(45, 55, 70, 0.5)' },
                            ticks: { color: '#e6e6e6' }
                        },
                        y: {
                            grid: { color: 'rgba(45, 55, 70, 0.5)' },
                            ticks: { color: '#e6e6e6' }
                        }
                    }
                }
            });

            // Successful Logins Per Hour Chart
            const successCtx = document.getElementById('successfulLoginsChart').getContext('2d');
            charts.successfulLogins = new Chart(successCtx, {
                type: 'line',
                data: {
                    labels: loginStats.hours,
                    datasets: [{
                        label: 'Successful Logins',
                        data: loginStats.successfulByHour,
                        borderColor: '#77b300',
                        backgroundColor: 'rgba(119, 179, 0, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#e6e6e6' }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(45, 55, 70, 0.5)' },
                            ticks: { color: '#e6e6e6' }
                        },
                        y: {
                            grid: { color: 'rgba(45, 55, 70, 0.5)' },
                            ticks: { color: '#e6e6e6' }
                        }
                    }
                }
            });

            // Severity Distribution Chart
            const severityCtx = document.getElementById('severityChart').getContext('2d');
            charts.severity = new Chart(severityCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Critical', 'Warning', 'Normal'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: ['#cc0000', '#ff8800', '#77b300'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#e6e6e6',
                                padding: 15
                            }
                        }
                    }
                }
            });

            // IP Frequency Chart
            const ipCtx = document.getElementById('ipFrequencyChart').getContext('2d');
            charts.ipFrequency = new Chart(ipCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Attack Frequency',
                        data: [],
                        backgroundColor: '#2a9fd6'
                    }]
            },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#e6e6e6' }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(45, 55, 70, 0.5)' },
                            ticks: { color: '#e6e6e6' }
                        },
                        y: {
                            grid: { color: 'rgba(45, 55, 70, 0.5)' },
                            ticks: { color: '#e6e6e6' }
                        }
                    }
                }
            });
        }

        function getSeverityDistribution() {
            const critical = securityEvents.filter(e => e.severity === 'Critical').length;
            const warning = securityEvents.filter(e => e.severity === 'Warning').length;
            const normal = securityEvents.filter(e => e.severity === 'Normal').length;
            return { critical, warning, normal };
        }

        function getIPFrequency() {
            const ipCounts = {};
            securityEvents.forEach(event => {
                ipCounts[event.ip] = (ipCounts[event.ip] || 0) + 1;
            });

            return Object.entries(ipCounts)
                .map(([ip, count]) => ({ ip, count }))
                .sort((a, b) => b.count - a.count);
        }

        function calculateBlockDuration(blockedAt, unblockedAt) {
            const blockedTime = new Date(blockedAt);
            const unblockedTime = new Date(unblockedAt);
            const durationMs = unblockedTime - blockedTime;
            const durationHours = Math.floor(durationMs / (1000 * 60 * 60));
            const durationMinutes = Math.floor((durationMs % (1000 * 60 * 60)) / (1000 * 60));

            return durationHours > 0 ?
                `${durationHours}h ${durationMinutes}m` :
                `${durationMinutes}m`;
        }

        // ============================================
        // HELPER FUNCTIONS
        // ============================================
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();

            const toast = document.createElement('div');
            toast.className = `toast cyber-toast ${type === 'success' ? 'toast-success' : type === 'error' ? 'toast-error' : ''}`;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            toast.id = toastId;

            toast.innerHTML = `
                <div class="toast-header">
                    <i class="fas ${type === 'success' ? 'fa-check-circle text-success' : type === 'error' ? 'fa-exclamation-circle text-danger' : 'fa-info-circle text-primary'} me-2"></i>
                    <strong class="me-auto">CyberPulse</strong>
                    <small>Just now</small>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    ${message}
                </div>
            `;

            toastContainer.appendChild(toast);
            const bsToast = new bootstrap.Toast(toast, { delay: 5000 });
            bsToast.show();

            toast.addEventListener('hidden.bs.toast', () => toast.remove());
        }

        function applyFilters() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const severity = document.getElementById('severityFilter').value;
            const eventType = document.getElementById('eventTypeFilter').value;

            // For now, just filter the local data
            let filteredEvents = [...securityEvents];

            if (startDate) {
                filteredEvents = filteredEvents.filter(event =>
                    new Date(event.time) >= new Date(startDate)
                );
            }

            if (endDate) {
                filteredEvents = filteredEvents.filter(event =>
                    new Date(event.time) <= new Date(endDate)
                );
            }

            if (severity !== 'all') {
                filteredEvents = filteredEvents.filter(event =>
                    event.severity.toLowerCase() === severity
                );
            }

            if (eventType !== 'all') {
                filteredEvents = filteredEvents.filter(event =>
                    event.eventType.toLowerCase().replace(' ', '-') === eventType
                );
            }

            // Temporarily use filtered data for display
            const originalEvents = securityEvents;
            securityEvents = filteredEvents;
            updateSecurityEventsTable();
            updateSummaryStatistics();
            securityEvents = originalEvents; // Restore original data

            showToast(`Filters applied: ${filteredEvents.length} events found`, 'success');
        }

        function resetFilters() {
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            document.getElementById('severityFilter').value = 'all';
            document.getElementById('eventTypeFilter').value = 'all';
            updateSecurityEventsTable();
            updateSummaryStatistics();
            showToast('Filters reset', 'info');
        }

        // ============================================
        // REPORT FUNCTIONS
        // ============================================
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const reportPeriod = getTimePeriodDisplay();
            const reportFormat = document.getElementById('reportFormat').value;

            document.getElementById('reportPlaceholder').style.display = 'none';
            document.getElementById('reportContent').style.display = 'block';

            const reportContent = document.getElementById('reportContent');
            const severityDist = getSeverityDistribution();
            const ipFrequency = getIPFrequency();

            reportContent.innerHTML = `
                <h4>CyberPulse Security Report</h4>
                <p><strong>Report Type:</strong> ${document.getElementById('reportType').options[document.getElementById('reportType').selectedIndex].text}</p>
                <p><strong>Time Period:</strong> ${reportPeriod}</p>
                <p><strong>Generated:</strong> ${new Date().toLocaleString()}</p>
                <hr>

                <div class="report-section-title">Security Summary</div>
                <div class="report-metric"><strong>Total Attacks:</strong> ${securityEvents.length}</div>
                <div class="report-metric"><strong>Failed Logins:</strong> ${securityEvents.filter(e => e.eventType.includes('Failed') || e.eventType.includes('Login')).length}</div>
                <div class="report-metric"><strong>Brute Force Attempts:</strong> ${securityEvents.filter(e => e.eventType.includes('Brute') || e.eventType.includes('Force')).length}</div>
                <div class="report-metric"><strong>Currently Blocked IPs:</strong> ${blockedIPs.length}</div>
                <div class="report-metric"><strong>Historically Unblocked IPs:</strong> ${unblockedIPs.length}</div>

                <div class="report-section-title">Severity Level</div>
                <div class="report-metric"><strong>Critical:</strong> ${severityDist.critical}</div>
                <div class="report-metric"><strong>Warning:</strong> ${severityDist.warning}</div>
                <div class="report-metric"><strong>Normal:</strong> ${severityDist.normal}</div>

                ${blockedIPs.length > 0 ? `
                <div class="report-section-title">Currently Blocked IP Addresses</div>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>IP Address</th>
                            <th>Blocked At</th>
                            <th>Reason</th>
                            <th>Events Count</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${blockedIPs.map(blocked => `
                            <tr>
                                <td>${blocked.ip}</td>
                                <td>${blocked.blockedAt}</td>
                                <td>${blocked.reason}</td>
                                <td>${blocked.eventCount}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                ` : ''}

                ${unblockedIPs.length > 0 ? `
                <div class="report-section-title">Historically Unblocked IP Addresses</div>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>IP Address</th>
                            <th>Originally Blocked</th>
                            <th>Unblocked At</th>
                            <th>Reason</th>
                            <th>Events Count</th>
                            <th>Block Duration</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${unblockedIPs.map(unblocked => {
                            const duration = calculateBlockDuration(unblocked.blockedAt, unblocked.unblockedAt);
                            return `
                            <tr>
                                <td>${unblocked.ip}</td>
                                <td>${unblocked.blockedAt}</td>
                                <td>${unblocked.unblockedAt}</td>
                                <td>${unblocked.reason}</td>
                                <td>${unblocked.eventCount}</td>
                                <td>${duration}</td>
                            </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
                ` : ''}

                <div class="mt-4">
                    <button class="btn btn-cyber" onclick="downloadReport('${reportFormat}')">
                        <i class="fas fa-download me-2"></i>Download ${reportFormat.toUpperCase()} Report
                    </button>
                </div>
            `;
        }

        function getTimePeriodDisplay() {
            const reportPeriod = document.getElementById('reportPeriod').value;
            if (reportPeriod === 'custom') {
                const startDate = document.getElementById('customStartDate').value;
                const endDate = document.getElementById('customEndDate').value;
                if (startDate && endDate) {
                    const start = new Date(startDate).toLocaleDateString();
                    const end = new Date(endDate).toLocaleDateString();
                    return `${start} to ${end}`;
                }
                return 'Custom Range';
            }
            const select = document.getElementById('reportPeriod');
            return select.options[select.selectedIndex].text;
        }

        function previewReport() {
            showToast('Report preview would open in a new window when connected to backend', 'info');
        }

        function downloadReport(format) {
            showToast(`${format.toUpperCase()} report download would be implemented here`, 'info');
        }
    </script>
</body>
</html>
